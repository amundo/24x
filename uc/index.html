<!doctype html>
<html>
<head>
  <meta charset=utf-8>
  <link rel="apple-touch-icon" sizes="180x180" href="img/bus_icon.png">
  <title>
    24X @ UCSB
  </title>
  <style>

* {
  padding: 0;
  margin: 0;
}

html {
  height: 100vh;
}

body {
  min-height: 100vh;
  text-align:center;
  background-image: linear-gradient(blanchedalmond, turquoise);
  display: flex;
  padding: 1em;
  flex-direction:column;
  justify-content:space-around;
  align-items:center;
}

h1 {
  font-family: 'Impact';
  vertical-align:center;
  flex:1;
}

figure {
  flex: 1;
  display:flex;
  justify-content: center;
  align-items: center;
}

</style>

</head>
<body>
<h2>@UCSB bus loop</h2>
<figure>

<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.1"
   width="99.999962"
   height="100.9845"
   id="svg2">
  <defs
     id="defs4" />
  <metadata
     id="metadata7">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     transform="translate(-111.21996,-657.83562)"
     id="layer1">
    <path
       d="m 161.10425,657.83576 c -2.76976,0.004 -5.21221,0.0831 -8.02224,0.2339 -2.67029,0.14332 -9.08807,0.48895 -14.26175,0.76493 -12.92686,0.68955 -14.92631,0.84276 -16.97377,1.28963 -3.28546,0.71706 -5.02342,1.94881 -6.08147,4.32404 -0.96004,2.15521 -1.30755,4.26823 -2.03559,12.27674 -0.11632,1.27951 -0.34054,3.64635 -0.49941,5.25965 -0.15887,1.6133 -0.42828,4.38979 -0.60056,6.16998 -0.17229,1.78019 -0.45136,4.64771 -0.61953,6.37227 -0.79757,8.17904 -0.90248,9.97071 -0.70171,12.44111 0.10851,1.33514 0.25033,2.74678 0.31609,3.13556 0.0658,0.38878 0.25138,1.93633 0.41091,3.439 0.15953,1.50268 0.42673,3.9144 0.58792,5.36081 0.16118,1.4464 0.43312,3.90428 0.60688,5.46194 0.17376,1.55767 0.44708,4.01555 0.60688,5.46195 0.49286,4.4611 0.87594,7.51679 1.1063,8.78716 0.42178,2.326 1.22526,3.69646 2.50971,4.27979 0.80011,0.36336 2.32219,0.37502 43.37318,0.37931 47.71426,0.005 44.70149,0.0991 46.19266,-1.39078 1.42225,-1.42106 1.5514,-2.28046 3.4959,-23.18167 0.16561,-1.78019 0.39268,-4.14703 0.50573,-5.25965 0.26255,-2.58396 0.26751,-14.6931 0.006,-16.68929 -0.28371,-2.16836 -0.78193,-6.53223 -1.10629,-9.71013 -0.15332,-1.50203 -0.4213,-4.09646 -0.60056,-5.76539 -0.17927,-1.66893 -0.45252,-4.26335 -0.60689,-5.76539 -0.15437,-1.50203 -0.37849,-3.68681 -0.49941,-4.85506 -0.7195,-6.95097 -2.28458,-9.367 -6.81479,-10.52563 -2.57883,-0.65955 -3.76035,-0.784 -10.31069,-1.09998 -3.43661,-0.16578 -8.02098,-0.39007 -10.19058,-0.49941 -9.65157,-0.48643 -15.17699,-0.70173 -19.79324,-0.69539 z m 36.74171,64.2095 c 1.32097,0.006 2.65453,0.4607 3.76141,1.43503 1.02023,0.89803 1.52793,1.74858 1.93444,3.24935 0.59533,2.19786 -0.80279,5.01047 -3.06602,6.15733 -1.06385,0.53909 -3.11941,0.79698 -4.00164,0.50574 -3.21139,-1.06014 -5.08311,-4.09407 -4.32404,-7.01709 0.70719,-2.7232 3.17401,-4.34194 5.69585,-4.33036 z m -72.9208,0.41091 c 0.10894,-0.003 0.2262,0 0.34137,0 2.39239,0 4.21764,1.09998 5.25334,3.16085 0.67358,1.34032 0.69161,3.40754 0.0379,4.75392 -0.55193,1.13678 -1.97855,2.4944 -3.13557,2.99016 -3.85647,1.65242 -7.91209,-1.09147 -7.91476,-5.35448 -0.001,-1.69964 0.40048,-2.64307 1.6626,-3.90681 1.16044,-1.16192 2.12098,-1.59438 3.75509,-1.64364 z m 80.04536,22.03112 -7.02973,0.0569 -7.02973,0.0506 0,4.24818 c 0,4.16702 0.008,4.27092 0.53102,5.38609 1.0181,2.17129 2.83533,3.67618 5.02575,4.15968 2.71791,0.59993 5.52597,-0.48068 7.14984,-2.74362 1.23631,-1.72284 1.35285,-2.30251 1.35285,-6.96019 l 0,-4.19761 z m -86.58199,0.40459 0,3.86256 c 0,4.13861 0.16404,5.25188 0.96722,6.56192 1.00981,1.64708 2.31728,2.72833 3.95106,3.262 1.37437,0.44893 3.84648,0.25154 5.23436,-0.41723 1.35022,-0.65062 2.70816,-2.02677 3.4074,-3.45165 0.48021,-0.97854 0.49941,-1.15308 0.49941,-5.3608 l 0,-4.34933 -7.02973,-0.0506 -7.02972,-0.0569 z"
       id="bus"
       style="fill:#000000" />
  </g>
</svg>
</figure>

<!-- <img src=../img/bus.svg> -->
<h1></h1>

<script src=../js/fetch.js> </script>
<script src=../js/moment.min.js> </script>

<script>
fetch('../toSB.json')
  .then(function (response) { return response.json(); })
  .then(getNextBus);

function getNextBus(times){
  var amFlag = true,
      prevTime = moment("00:00", "HH:mm"),
      currTime;

  var ucsb = times.map(function (time) {
    currTime = moment(time.UCSB, "HH:mm");
    if (amFlag) {
      if (currTime < prevTime) {
        amFlag = false;
        return currTime.add(12, 'hours');
      } else {
        prevTime = currTime;
      }
      return currTime;
    } else {
      return currTime.add(12, 'hours');
    }
  });

  ucsb.filter(function (el) { return el !== undefined });

  // times.map(function (time) {
    var deltas = ucsb.map(function (time) {
      return moment(time, 'HH:mm').fromNow();
    });

    var futures = deltas.filter(function (delta) {
      return delta.indexOf('ago') == -1;
    });

    var next = futures[0];

    document.body.querySelector('h1').innerHTML = next;
  // });
}

</script>
</body>
</html>
